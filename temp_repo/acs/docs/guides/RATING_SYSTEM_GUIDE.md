# Rating Request System Guide

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 26 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 1.0

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
- [–õ–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞](#–ª–æ–≥–∏–∫–∞-–ø–æ–∫–∞–∑–∞)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∏-–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —á–∞—Ç](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-–≤-—á–∞—Ç)
- [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ü–µ–Ω–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤ Google Play Store, —Å–ª–µ–¥—É—è –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º UX –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

‚úÖ **–û–¥–∏–Ω —Ä–∞–∑ –∏ –Ω–∞–≤—Å–µ–≥–¥–∞** - –ø–æ—Å–ª–µ –æ—Ü–µ–Ω–∫–∏ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∏–¥–±–µ–∫–∞ –¥–∏–∞–ª–æ–≥ –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
‚úÖ **–£–º–Ω—ã–π —Ç–∞–π–º—ñ–Ω–≥** - –ø–æ–∫–∞–∑ –≤ –º–æ–º–µ–Ω—Ç –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (–ø–æ—Å–ª–µ –≤—Ç–æ—Ä–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ)
‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫** - –º–∞–∫—Å–∏–º—É–º 3 –ø–æ–∫–∞–∑–∞ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è
‚úÖ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã** - –º–∏–Ω–∏–º—É–º 24 —á–∞—Å–∞ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–∫–∞–∑–∞, 3 –¥–Ω—è –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–∫–∞–∑–∞–º–∏
‚úÖ **–£–≤–∞–∂–µ–Ω–∏–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é** - –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         RatingService                       ‚îÇ
‚îÇ  (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏)                 ‚îÇ
‚îÇ  - shouldShowRatingDialog()                 ‚îÇ
‚îÇ  - incrementRatingDialogShows()             ‚îÇ
‚îÇ  - markRatingCompleted()                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      RatingRequestDialog                    ‚îÇ
‚îÇ  (UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–∏–∞–ª–æ–≥–∞)                     ‚îÇ
‚îÇ  - –¢—Ä–∏ —à–∞–≥–∞: initial, enjoying, feedback    ‚îÇ
‚îÇ  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Play                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        ChatAIScreen                         ‚îÇ
‚îÇ  (–¢–æ—á–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)                         ‚îÇ
‚îÇ  - _checkAndShowRatingDialog()              ‚îÇ
‚îÇ  - –ü–æ–∫–∞–∑ –ø–æ—Å–ª–µ 2-–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Å—ã–ª–∫–∞ |
|------|-----------|--------|
| `rating_service.dart` | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ | [lib/services/rating_service.dart](../lib/services/rating_service.dart) |
| `rating_request_dialog.dart` | UI –¥–∏–∞–ª–æ–≥–∞ –æ—Ü–µ–Ω–∫–∏ | [lib/widgets/rating_request_dialog.dart](../lib/widgets/rating_request_dialog.dart) |
| `chat_ai_screen.dart` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —á–∞—Ç | [lib/screens/chat_ai_screen.dart](../lib/screens/chat_ai_screen.dart) |
| `app_config.dart` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | [lib/config/app_config.dart](../lib/config/app_config.dart) |

## –õ–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞

### –£—Å–ª–æ–≤–∏—è –ø–æ–∫–∞–∑–∞ –¥–∏–∞–ª–æ–≥–∞

–î–∏–∞–ª–æ–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã **–≤—Å–µ** —É—Å–ª–æ–≤–∏—è:

```dart
// 1. –≠—Ç–æ –≤—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
_getUserMessageCount() == 2

// 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –æ—Ü–µ–Ω–∏–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
!isRatingCompleted

// 3. –ü—Ä–æ—à–ª–æ –º–∏–Ω–∏–º—É–º 24 —á–∞—Å–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏
hoursSinceInstall >= 24

// 4. –° –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–∫–∞–∑–∞ –ø—Ä–æ—à–ª–æ –º–∏–Ω–∏–º—É–º 3 –¥–Ω—è (–¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–∫–∞–∑–æ–≤)
daysSinceLastShow >= 3

// 5. –ù–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–∫–∞–∑–æ–≤
showsCount < maxRatingDialogShows (3)
```

### –£—Å–ª–æ–≤–∏—è –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏—è –ø–æ–∫–∞–∑–æ–≤

–î–∏–∞–ª–æ–≥ **–±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è** –µ—Å–ª–∏:

```dart
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Å—Ç–∞–≤–∏–ª 5 –∑–≤–µ–∑–¥ –∏ –ø–µ—Ä–µ—à–µ–ª –≤ Google Play
ratingCompleted = true

// 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª —Ñ–∏–¥–±–µ–∫
ratingCompleted = true

// 3. –ü—Ä–µ–≤—ã—à–µ–Ω –º–∞–∫—Å–∏–º—É–º –ø–æ–∫–∞–∑–æ–≤ (3 —Ä–∞–∑–∞)
showsCount >= 3
```

### –§–ª–æ—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 1-–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
         ‚îÇ
         ‚ñº
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 2-–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
         ‚îÇ
         ‚ñº
–ë–æ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–µ—á–∞—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç
         ‚îÇ
         ‚ñº
–ó–∞–¥–µ—Ä–∂–∫–∞ 500–º—Å
         ‚îÇ
         ‚ñº
–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –ø–æ–∫–∞–∑–∞
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         ‚îÇ
   –î–ê        –ù–ï–¢
    ‚îÇ         ‚îÇ
    ‚ñº         ‚ñº
  –î–∏–∞–ª–æ–≥   –ü—Ä–æ–ø—É—Å–∫
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–∞–≥ 1: "–ù—Ä–∞–≤–∏—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?"     ‚îÇ
‚îÇ   [–ù–µ –æ—á–µ–Ω—å] [–î–∞, –∫–ª–∞—Å—Å–Ω–æ!]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ                   ‚îÇ
    ‚îÇ –ù–ï–¢              –î–ê
    ‚îÇ                   ‚îÇ
    ‚ñº                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–∞–≥ 3: –§–∏–¥–±–µ–∫ ‚îÇ  ‚îÇ –®–∞–≥ 2: –û—Ü–µ–Ω–∫–∞       ‚îÇ
‚îÇ [–¢–µ–∫—Å—Ç –ø–æ–ª–µ]  ‚îÇ  ‚îÇ [‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê]          ‚îÇ
‚îÇ [–û—Ç–ø—Ä–∞–≤–∏—Ç—å] ‚îÄ‚îÄ‚îº‚îÄ‚ñ∫‚îÇ                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ –ï—Å–ª–∏ 5‚≠ê:            ‚îÇ
  markCompleted()  ‚îÇ  ‚Üí Google Play       ‚îÇ
                   ‚îÇ    markCompleted()   ‚îÇ
                   ‚îÇ                      ‚îÇ
                   ‚îÇ –ï—Å–ª–∏ <5‚≠ê:           ‚îÇ
                   ‚îÇ  ‚Üí –§–∏–¥–±–µ–∫            ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ RatingService

```dart
// lib/services/rating_service.dart

// –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–∫–∞–∑–∞–º–∏ –≤ –¥–Ω—è—Ö
static const int _minDaysBetweenShows = 3;

// –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –ø–æ–∫–∞–∑–æ–º –≤ —á–∞—Å–∞—Ö
static const int _minHoursBeforeFirstShow = 24;
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ .env

```env
# assets/config/.env

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤ –¥–∏–∞–ª–æ–≥–∞ –æ—Ü–µ–Ω–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3)
MAX_RATING_DIALOG_SHOWS=3
```

### –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö (SharedPreferences)

| –ö–ª—é—á | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `rating_dialog_shows_count` | int | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤ –¥–∏–∞–ª–æ–≥–∞ |
| `last_rating_dialog_date` | String (ISO8601) | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–∫–∞–∑–∞ |
| `rating_completed` | bool | –§–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ |
| `app_install_date` | String (ISO8601) | –î–∞—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —á–∞—Ç

### –ú–µ—Ç–æ–¥ –ø–æ–¥—Å—á–µ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

```dart
// lib/screens/chat_ai_screen.dart

// –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–∏—Å–∫–ª—é—á–∞—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –±–æ—Ç–∞)
int _getUserMessageCount() {
  return _messages.where((msg) => msg.isUser).length;
}
```

### –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ–∫–∞–∑–∞ –¥–∏–∞–ª–æ–≥–∞

```dart
// lib/screens/chat_ai_screen.dart:505-542

Future<void> _checkAndShowRatingDialog() async {
  try {
    final userMessageCount = _getUserMessageCount();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—Ç–æ—Ä–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (userMessageCount != 2) {
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –æ—Ü–µ–Ω–∫–∏
    final shouldShow = await RatingService().shouldShowRatingDialog();

    if (!shouldShow) {
      return;
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–µ–ª –Ω–∞—á–∞–ª–æ –ø–µ—á–∞—Ç–∏
    await Future.delayed(const Duration(milliseconds: 500));

    if (!mounted) return;

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –æ—Ü–µ–Ω–∫–∏
    await showDialog(
      context: context,
      barrierDismissible: true,
      builder: (BuildContext context) => const RatingRequestDialog(),
    );

    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–∫–∞–∑–æ–≤
    await RatingService().incrementRatingDialogShows();
  } catch (e) {
    debugPrint('=== RATING DEBUG: Error showing rating dialog: $e ===');
  }
}
```

### –í—ã–∑–æ–≤ –≤ –º–æ–º–µ–Ω—Ç –ø–µ—á–∞—Ç–∏ –æ—Ç–≤–µ—Ç–∞

```dart
// lib/screens/chat_ai_screen.dart:777-780

// –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–µ—á–∞—Ç–∏ —Ç–µ–∫—Å—Ç–∞
_startTypingAnimation(messageIndex, response);

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ—Ä–∞ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –æ—Ü–µ–Ω–∫–∏
_checkAndShowRatingDialog();
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ DO

1. **–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –º–æ–º–µ–Ω—Ç –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ –æ–ø—ã—Ç–∞**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø–æ–ª—É—á–∏–ª 2 –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI
   - –û–Ω –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –í–∏–¥–Ω–∞ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

2. **–î–∞–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π –ø—É—Ç—å –æ—Ç–∫–∞–∑–∞**
   - –î–∏–∞–ª–æ–≥ –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π
   - –ù–µ—Ç –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∫–Ω–æ–ø–æ–∫ "–û—Ü–µ–Ω–∏—Ç—å —Å–µ–π—á–∞—Å!"
   - –ï—Å—Ç—å –≤—ã–±–æ—Ä: –æ—Ü–µ–Ω–∏—Ç—å –∏–ª–∏ –¥–∞—Ç—å —Ñ–∏–¥–±–µ–∫

3. **–£–≤–∞–∂–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - –ü–æ—Å–ª–µ –æ—Ü–µ–Ω–∫–∏ –±–æ–ª—å—à–µ –Ω–µ –±–µ—Å–ø–æ–∫–æ–∏–º
   - –ü–æ—Å–ª–µ —Ñ–∏–¥–±–µ–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –±–µ—Å–ø–æ–∫–æ–∏–º
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫

4. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**
   ```dart
   debugPrint('=== RATING DEBUG: User message count: $userMessageCount ===');
   ```

### ‚ùå DON'T

1. **–ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ**
   - ‚ùå –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - ‚ùå –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
   - ‚ùå –í –ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

2. **–ù–µ —Å–ø–∞–º–∏—Ç—å**
   - ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
   - ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–æ–ª–µ–µ 3 —Ä–∞–∑
   - ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

3. **–ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**
   - ‚ùå –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–∫—Ä—ã—Ç—å
   - ‚ùå –¢—Ä–µ–±–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É
   - ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –ø–æ–∫–∞–∑

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∏–ª–∏ —Å–±—Ä–æ—Å—å—Ç–µ –¥–∞–Ω–Ω—ã–µ)
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 24 —á–∞—Å–∞ –ò–õ–ò –∏–∑–º–µ–Ω–∏—Ç–µ –¥–∞—Ç—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Ä—É—á–Ω—É—é –≤ SharedPreferences
3. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç —Å AI
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ 1-–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç
5. –û—Ç–ø—Ä–∞–≤—å—Ç–µ 2-–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –±–æ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–µ—á–∞—Ç–∞—Ç—å
6. **–û–∂–∏–¥–∞–Ω–∏–µ**: —á–µ—Ä–µ–∑ 500–º—Å –ø–æ—è–≤–∏—Ç—Å—è –¥–∏–∞–ª–æ–≥ –æ—Ü–µ–Ω–∫–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ü–µ–Ω–∫–∞ 5 –∑–≤–µ–∑–¥

1. –í –¥–∏–∞–ª–æ–≥–µ –Ω–∞–∂–º–∏—Ç–µ "–î–∞, –∫–ª–∞—Å—Å–Ω–æ!"
2. –ü–æ—Å—Ç–∞–≤—å—Ç–µ 5 –∑–≤–µ–∑–¥
3. –ù–∞–∂–º–∏—Ç–µ "–û—Ü–µ–Ω–∏—Ç—å –≤ Google Play"
4. **–û–∂–∏–¥–∞–Ω–∏–µ**: –¥–∏–∞–ª–æ–≥ –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –±–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –§–∏–¥–±–µ–∫

1. –í –¥–∏–∞–ª–æ–≥–µ –Ω–∞–∂–º–∏—Ç–µ "–ù–µ –æ—á–µ–Ω—å"
2. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ñ–∏–¥–±–µ–∫–∞
3. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤"
4. **–û–∂–∏–¥–∞–Ω–∏–µ**: –¥–∏–∞–ª–æ–≥ –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –±–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è

#### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ó–∞–∫—Ä—ã—Ç–∏–µ –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏—è

1. –í –¥–∏–∞–ª–æ–≥–µ –Ω–∞–∂–º–∏—Ç–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏ –¥–∏–∞–ª–æ–≥–∞ –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
2. –î–∏–∞–ª–æ–≥ –∑–∞–∫—Ä–æ–µ—Ç—Å—è
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 3 –¥–Ω—è –ò–õ–ò –∏–∑–º–µ–Ω–∏—Ç–µ –¥–∞—Ç—É –≤ SharedPreferences
4. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —à–∞–≥–∏ –∏–∑ –°—Ü–µ–Ω–∞—Ä–∏—è 1
5. **–û–∂–∏–¥–∞–Ω–∏–µ**: –¥–∏–∞–ª–æ–≥ –ø–æ—è–≤–∏—Ç—Å—è —Å–Ω–æ–≤–∞ (–¥–æ 3 —Ä–∞–∑ –º–∞–∫—Å–∏–º—É–º)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
dart test_rating_feature.dart
```

–§–∞–π–ª: [test_rating_feature.dart](../test_rating_feature.dart)

### –°–±—Ä–æ—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```dart
// –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Å—á–µ—Ç—á–∏–∫–∏ –∏ —Ñ–ª–∞–≥–∏
await RatingService().resetRatingDialogShows();
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SharedPreferences:
- –£–¥–∞–ª–∏—Ç—å –∫–ª—é—á–∏: `rating_dialog_shows_count`, `last_rating_dialog_date`, `rating_completed`

### Debug –ª–æ–≥–∏

–í–∫–ª—é—á–∏—Ç–µ debug —Ä–µ–∂–∏–º –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤:

```dart
=== RATING DEBUG: User message count: 2 ===
=== RATING DEBUG: Should show rating dialog: true ===
=== RATING DEBUG: Rating dialog shown and counter incremented ===
```

## –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤

```dart
// assets/config/.env
MAX_RATING_DIALOG_SHOWS=5  // –ë—ã–ª–æ 3, —Å—Ç–∞–ª–æ 5
```

### –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–∫–∞–∑–∞–º–∏

```dart
// lib/services/rating_service.dart
static const int _minDaysBetweenShows = 7;  // –ë—ã–ª–æ 3, —Å—Ç–∞–ª–æ 7
```

### –ò–∑–º–µ–Ω–∏—Ç—å –º–∏–Ω–∏–º—É–º —á–∞—Å–æ–≤ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–∫–∞–∑–∞

```dart
// lib/services/rating_service.dart
static const int _minHoursBeforeFirstShow = 48;  // –ë—ã–ª–æ 24, —Å—Ç–∞–ª–æ 48
```

### –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–º–µ–Ω—Ç –ø–æ–∫–∞–∑–∞

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ø–æ—Å–ª–µ 2-–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```dart
// lib/screens/chat_ai_screen.dart

// –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ 3-–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:
if (userMessageCount != 3) {  // –ë—ã–ª–æ 2, —Å—Ç–∞–ª–æ 3
  return;
}
```

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

1. **Conversion Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ—Å—Ç–∞–≤–∏–≤—à–∏—Ö –æ—Ü–µ–Ω–∫—É
2. **Show Rate** - —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–∫–∞–∑–∞–ª—Å—è –¥–∏–∞–ª–æ–≥ –Ω–∞ 1000 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **Feedback Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –æ—Å—Ç–∞–≤–∏–≤—à–∏—Ö —Ñ–∏–¥–±–µ–∫
4. **Dismiss Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç–∏–π –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

–ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Firebase Analytics:

```dart
// lib/screens/chat_ai_screen.dart

Future<void> _checkAndShowRatingDialog() async {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

  if (shouldShow) {
    // –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–∫–∞–∑
    await FirebaseAnalytics.instance.logEvent(
      name: 'rating_dialog_shown',
      parameters: {'user_message_count': userMessageCount},
    );

    await showDialog(...);
  }
}
```

```dart
// lib/widgets/rating_request_dialog.dart

// –ü—Ä–∏ –æ—Ü–µ–Ω–∫–µ 5 –∑–≤–µ–∑–¥
await FirebaseAnalytics.instance.logEvent(
  name: 'rating_submitted',
  parameters: {'rating': 5, 'redirected_to_store': true},
);

// –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∏–¥–±–µ–∫–∞
await FirebaseAnalytics.instance.logEvent(
  name: 'feedback_submitted',
  parameters: {'rating': _rating},
);
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [ARCHITECTURE.md](ARCHITECTURE.md) - –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [COMMON_ISSUES.md](COMMON_ISSUES.md) - –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
- [API_INTEGRATION.md](API_INTEGRATION.md) - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 26 –æ–∫—Ç—è–±—Ä—è 2025 - v1.0
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ü–µ–Ω–∫–∏
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞ –ø–æ—Å–ª–µ 2-–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (24—á, 3 –¥–Ω—è)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Play
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ñ–∏–¥–±–µ–∫–∞ –¥–ª—è –Ω–∏–∑–∫–∏—Ö –æ—Ü–µ–Ω–æ–∫
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

---

**–ê–≤—Ç–æ—Ä**: AI Assistant
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 26 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 1.0
